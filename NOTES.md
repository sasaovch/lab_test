У нас есть DOMFile. Он получает путь до dom.dbx и хранит XML ноды по страницам - page_header | node-data1 ... node-dataN |
Создает файл если его нет.

## Документное дерево (Document-oriented database)
похоже на key-value
- в нем нет отношений. Только родитель-ребенок
- в нем нет схемы??? Что такое схема?
- получение данных через query запрос

## Storage
- В файле страницы представляются как последовательный массив данных
- В оперативной памяти страницы разбросаны по памяти. 
  - Cache: загруженные страницы можно не брать с диска
  - No cache: мы не храним страницы в памяти, а только обращаемся к диску для каждой страницы
    - делаем mmap на существующую страницу, вместо malloc-а
    - делаем munmap на существующую страницу, вместо free-а???
    - при создании страницы делаем malloc
  

## Memory management
- *dirty page* - если данные изменились в странице после загрузки с диска
  - *cleaning* - запись измененных страниц на диск
- [Free page queue](https://en.wikipedia.org/wiki/Page_replacement_algorithm) - очередь с пустыми страницами. 
  - Похожий подход - *free lists* в [slab allocator](https://en.wikipedia.org/wiki/Slab_allocation)
- *smart pointer*
- (Memory pool implementation)[https://en.wikipedia.org/wiki/Memory_pool#Simple_memory_pool_implementation]
- Как связать данные из файла и страницы в оперативной памяти?
- Record ID = (page_number, slot_number)


## План по поиску и менеджменту пустых страниц:
- Первую страницу аллоцируем.
- все страницы заполняем по максимуму.
  1. Если осталось свободное место - ОК
  2. Если Элемент полностью поместился - помечаем страницу как занятую ИЛИ глобально устанавливаем новую свободную страницу
  3. Если метаданные не влезают - выполняем п2 и кладем элемент на новую страницу
  4. Если элемент влез частично, то выполняем п2 и остаток кладем на новую страницу. В метаданных отмечаем индекс страницы, на которой лежит вторая половина элемента.


### Вопросы, которые стоит обдумать
- Будем ли мы хранить индекс следующей страницы в заголовке страницы или в метаданных элемента. В итоге храним в метаданных номер страницы с продолжением
